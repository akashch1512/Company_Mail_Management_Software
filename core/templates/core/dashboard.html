{% extends 'core/base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Dashboard</h1>

<form method="get" class="flex flex-wrap gap-3 mb-4 items-end">
  <label class="text-sm">Hours
    <input type="number" name="hours" min="1" value="{{ filters.hours }}" class="border rounded p-1">
  </label>
  <label class="text-sm flex items-center gap-2">
    <input type="checkbox" name="assignment" value="1" {% if filters.assignment %}checked{% endif %}> Assignment only
  </label>
  <label class="text-sm">Employee
    <select name="employee" class="border rounded p-1">
      <option value="">All</option>
      {% for e in employees %}
        <option value="{{ e.id }}" {% if filters.employee|default:'' == e.id|stringformat:'s' %}selected{% endif %}>{{ e.display_name }}</option>
      {% endfor %}
    </select>
  </label>
  <label class="text-sm">Client
    <select name="client" class="border rounded p-1">
      <option value="">All</option>
      {% for c in clients %}
        <option value="{{ c.id }}" {% if filters.client|default:'' == c.id|stringformat:'s' %}selected{% endif %}>{{ c.code }} â€“ {{ c.name }}</option>
      {% endfor %}
    </select>
  </label>
  <button class="bg-slate-900 text-white rounded px-3 py-1">Apply</button>
</form>

<div class="bg-white rounded-2xl shadow divide-y">
  <div class="grid grid-cols-12 gap-4 px-4 py-2 text-xs font-semibold text-slate-500">
    <div class="col-span-2">Employee</div>
    <div class="col-span-2">Client</div>
    <div class="col-span-5">Subject</div>
    <div class="col-span-1">Assign</div>
    <div class="col-span-2">When</div>
  </div>
  {% for m in messages %}
  <div class="grid grid-cols-12 gap-4 px-4 py-3 items-center hover:bg-slate-50">
    <div class="col-span-2 text-sm">{{ m.employee.display_name }}</div>
    <div class="col-span-2 text-sm">{% if m.client %}{{ m.client.name }}{% else %}Unassigned{% endif %}</div>
    <div class="col-span-5 truncate">
      <a
        hx-get="{% url 'message_modal' m.id %}"
        hx-target="#modal-body" hx-swap="innerHTML"
        class="text-slate-900 hover:underline">
        {{ m.subject }}
      </a>
      <div class="text-xs text-slate-500 truncate">{{ m.sender }}</div>
    </div>
    <div class="col-span-1">
      {% if m.is_assignment %}
        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Yes</span>
      {% else %}
        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">No</span>
      {% endif %}
    </div>
    <div class="col-span-2 text-sm">{{ m.received_at|date:'M d, H:i' }}</div>
  </div>
  {% empty %}
    <div class="p-6 text-center text-slate-500">No messages yet. Try the <a class="underline" href="/seed-demo/">demo seed</a>.</div>
  {% endfor %}
</div>
{% endblock %}
