{% extends 'core/base.html' %}
{% block content %}

<!-- Header -->
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-3xl font-semibold tracking-tight">Dashboard</h1>
    <p class="text-sm text-slate-600">Latest client emails across your team</p>
  </div>
  <div class="hidden md:flex items-center gap-2 text-xs text-slate-500">
    <span class="inline-flex items-center gap-1 bg-white border rounded-xl px-3 py-1">
      <span class="w-2 h-2 rounded-full {% if filters.assignment %}bg-green-500{% else %}bg-slate-400{% endif %}"></span>
      {% if filters.assignment %}Assignments only{% else %}All messages{% endif %}
    </span>
  </div>
</div>

<!-- Filters -->
<form method="get" class="bg-white rounded-2xl shadow p-4 mb-6">
  <div class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
    <label class="text-sm">
      <span class="block font-medium text-slate-700 mb-1">Hours</span>
      <input type="number" name="hours" min="1" value="{{ filters.hours }}"
             class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
    </label>

    <label class="text-sm md:col-span-2">
      <span class="block font-medium text-slate-700 mb-1">Employee</span>
      <select name="employee"
              class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
        <option value="">All</option>
        {% for e in employees %}
          <option value="{{ e.id }}" {% if filters.employee|default:'' == e.id|stringformat:'s' %}selected{% endif %}>
            {{ e.display_name }}
          </option>
        {% endfor %}
      </select>
    </label>

    <label class="text-sm md:col-span-2">
      <span class="block font-medium text-slate-700 mb-1">Client</span>
      <select name="client"
              class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
        <option value="">All</option>
        {% for c in clients %}
          <option value="{{ c.id }}" {% if filters.client|default:'' == c.id|stringformat:'s' %}selected{% endif %}>
            {{ c.code }} â€“ {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </label>

    <div class="flex items-center gap-3 md:col-span-3">
      <label class="text-sm inline-flex items-center gap-2 mt-2 md:mt-6">
        <input type="checkbox" name="assignment" value="1"
               class="rounded border-slate-300"
               {% if filters.assignment %}checked{% endif %}>
        Assignment only
      </label>
    </div>

    <div class="md:col-span-2 flex gap-2 justify-end mt-2 md:mt-6">
      <a href="?"
         class="rounded-xl border px-4 py-2 text-sm hover:bg-slate-50">Reset</a>
      <button class="rounded-xl bg-slate-900 px-4 py-2 text-sm text-white font-medium hover:opacity-95">
        Apply
      </button>
    </div>
  </div>
</form>

<!-- Messages table -->
<div class="bg-white rounded-2xl shadow overflow-hidden">
  <!-- Header row -->
  <div class="grid grid-cols-12 gap-4 px-4 py-3 text-xs font-semibold text-slate-500 border-b">
    <div class="col-span-3 md:col-span-2">Employee</div>
    <div class="col-span-3 md:col-span-2">Client</div>
    <div class="col-span-6 md:col-span-5">Subject</div>
    <div class="hidden md:block md:col-span-1">Assign</div>
    <div class="col-span-3 md:col-span-2">When</div>
  </div>

  {% for m in messages %}
  <div class="grid grid-cols-12 gap-4 px-4 py-4 items-center border-t hover:bg-slate-50">
    <!-- Employee -->
    <div class="col-span-3 md:col-span-2">
      <div class="text-sm font-medium">{{ m.employee.display_name }}</div>
      <div class="md:hidden text-xs text-slate-500 mt-0.5">
        {% if m.is_assignment %}
          <span class="inline-flex items-center text-green-700 bg-green-100 rounded-full px-2 py-0.5">Assign</span>
        {% else %}
          <span class="inline-flex items-center text-slate-600 bg-slate-100 rounded-full px-2 py-0.5">General</span>
        {% endif %}
      </div>
    </div>

    <!-- Client -->
    <div class="col-span-3 md:col-span-2">
      <div class="text-sm">
        {% if m.client %}{{ m.client.name }}{% else %}<span class="text-slate-500">Unassigned</span>{% endif %}
      </div>
      <div class="text-xs text-slate-500 truncate">{{ m.sender }}</div>
    </div>

    <!-- Subject -->
    <div class="col-span-6 md:col-span-5 min-w-0">
      <a
        hx-get="{% url 'message_modal' m.id %}"
        hx-target="#modal-body" hx-swap="innerHTML"
        class="text-slate-900 hover:underline line-clamp-1">
        {{ m.subject }}
      </a>
      {% if m.tags and m.tags|length %}
        <div class="mt-1 flex flex-wrap gap-1">
          {% for t in m.tags|slice:":3" %}
            <span class="text-[10px] bg-slate-100 px-2 py-0.5 rounded-full">{{ t }}</span>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Assign badge (desktop) -->
    <div class="hidden md:block md:col-span-1">
      {% if m.is_assignment %}
        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">Yes</span>
      {% else %}
        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">No</span>
      {% endif %}
    </div>

    <!-- When -->
    <div class="col-span-3 md:col-span-2 text-sm">
      {{ m.received_at|date:'M d, H:i' }}
    </div>
  </div>
  {% empty %}
    <div class="p-10 text-center">
      <div class="text-slate-400 text-5xl mb-3">ðŸ“­</div>
      <p class="text-slate-600">No messages yet.</p>
      <p class="text-sm text-slate-500 mt-1">
        Use <a class="underline" href="/seed-demo/">demo seed</a> to populate sample data.
      </p>
    </div>
  {% endfor %}
</div>

<!-- Footer hint -->
<p class="mt-4 text-xs text-slate-500">
  Tip: Click a subject to view details without leaving the page.
</p>

{% endblock %}
