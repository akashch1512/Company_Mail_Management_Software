{% extends 'core/base.html' %}
{% block content %}

<!-- Header -->
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-3xl font-semibold tracking-tight">Mappings</h1>
    <p class="text-sm text-slate-600">Link senders or subject patterns to clients</p>
  </div>
</div>

<!-- Add Mapping -->
<div class="bg-white rounded-2xl shadow p-6 mb-6">
  <h2 class="text-lg font-semibold mb-4">Add a Mapping</h2>
  <form method="post" action="/mappings/create/" class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
    {% csrf_token %}
    <label class="text-sm">
      <span class="block font-medium text-slate-700 mb-1">Client</span>
      <select name="client"
              class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
        {% for c in clients %}
          <option value="{{ c.id }}">{{ c.code }} â€“ {{ c.name }}</option>
        {% endfor %}
      </select>
    </label>

    <label class="text-sm">
      <span class="block font-medium text-slate-700 mb-1">Domain</span>
      <input name="domain" placeholder="acme.com"
             class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
      <span class="block text-[11px] text-slate-500 mt-1">e.g., acme.com</span>
    </label>

    <label class="text-sm">
      <span class="block font-medium text-slate-700 mb-1">Email</span>
      <input name="email" placeholder="user@acme.com"
             class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
      <span class="block text-[11px] text-slate-500 mt-1">More specific than domain</span>
    </label>

    <label class="text-sm">
      <span class="block font-medium text-slate-700 mb-1">Subject Pattern</span>
      <input name="subject_pattern" placeholder="C-13"
             class="w-full rounded-xl border px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
      <span class="block text-[11px] text-slate-500 mt-1">Keyword or code in subject</span>
    </label>

    <div class="md:col-span-4 flex justify-end gap-2">
      <button type="reset" class="rounded-xl border px-4 py-2 text-sm hover:bg-slate-50">Clear</button>
      <button class="rounded-xl bg-slate-900 px-4 py-2 text-sm text-white font-medium hover:opacity-95">
        Add Mapping
      </button>
    </div>
  </form>

  <p class="mt-3 text-xs text-slate-500">
    Priority: <span class="font-medium">Email</span> â†’ <span class="font-medium">Domain</span> â†’ <span class="font-medium">Subject Pattern</span>.
  </p>
</div>

<!-- Mappings Table -->
<div class="bg-white rounded-2xl shadow overflow-hidden">
  <div class="grid grid-cols-5 gap-4 px-4 py-3 text-xs font-semibold text-slate-500 border-b">
    <div>Client</div>
    <div>Domain</div>
    <div>Email</div>
    <div>Subject Pattern</div>
    <div class="text-right">Action</div>
  </div>

  {% for m in items %}
    <div class="grid grid-cols-5 gap-4 px-4 py-3 items-center border-t hover:bg-slate-50">
      <div class="text-sm">{{ m.client.name }}</div>
      <div class="text-sm">{% if m.domain %}<span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs">{{ m.domain }}</span>{% else %}<span class="text-slate-400 text-xs">â€”</span>{% endif %}</div>
      <div class="text-sm">{% if m.email %}<span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs">{{ m.email }}</span>{% else %}<span class="text-slate-400 text-xs">â€”</span>{% endif %}</div>
      <div class="text-sm">{% if m.subject_pattern %}<span class="px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 text-xs">{{ m.subject_pattern }}</span>{% else %}<span class="text-slate-400 text-xs">â€”</span>{% endif %}</div>
      <div class="text-right">
        <form method="post" action="/mappings/{{ m.id }}/delete/" onsubmit="return confirm('Delete this mapping?');" class="inline">
          {% csrf_token %}
          <button class="text-sm text-red-600 hover:text-red-700">Delete</button>
        </form>
      </div>
    </div>
  {% empty %}
    <div class="p-10 text-center">
      <div class="text-slate-400 text-5xl mb-3">ðŸ§­</div>
      <p class="text-slate-600">No mappings yet.</p>
      <p class="text-sm text-slate-500 mt-1">Create one above to auto-link messages to clients.</p>
    </div>
  {% endfor %}
</div>

{% endblock %}
